---
description: >
    The Orka Packer plugin is able to create base images for the Orka platform
    This plugin takes an original source image and run any additional provisioning
    steps that are required for creating the desired Orka golden base image.
page_title: Orka - Plugin
nav_title: Orka
---

# Compatibility

For this plugin to function you need to have at least Packer 1.7.0 installed.
The Orka CLI is optional as of v2.0.0 but is highly recommended to allow
you to access the Orka API for other tasks (such as tweaking, deleting or managing the
VMs and images) whilst building your packer logic via this plugin.

 * **[Packer Downloads]** - 1.7.0+
 * **[Orka CLI Downloads]** (Optional)  - 3.0+

# Packer Plugin Configuration

# HCL
```hcl
source "macstadium-orka" "image" {
  source_image    = "name-of-image-from-vm-images-list"
  image_name      = "destination-image-name"
  orka_endpoint   = "orka-endpoint"
  orka_auth_token = "eyJraWQ..."
}

build {
  sources = [
    "macstadium-orka.image"
  ]
  provisioner "shell" {
    inline = [
      "echo we are running on the remote host",
      "hostname",
      "touch .we-ran-packer-successfully"
    ]
  }
}
```

# Variables
* `type` _(string)_ **(required)**: Must be `macstadium-orka`

* `source_image` _(string)_ **(required)**:  This is the source image we will be using to launch the VM from.

* `image_name` _(string)_ (optional): This is the destination name of the image that will be created.  The image will be located inside `orka3 image list` when completed.  If not specified this will be autogenerated to the following: `packer-{{unix timestamp}}`

* `image_description` _(string)_ (optional): This is the plain text description of the generated image

* `image_force_overwrite` _(bool)_ (optional): If set, the given destination image will be overwritten if it exists. Otherwise, an error would be reported.

* `orka_endpoint` _(string)_ (optional): The Orka API endpoint to use

* `orka_auth_token` _(string)_ **(required)**: The authentication token of the user. This must be a [service account token](https://support.macstadium.com/hc/en-us/articles/28333065069211-Orka-Cluster-Manage-Service-Accounts) and can be created following the instructions outlined in the linked supporting documentation. 

* `ssh_user` _(string)_ (optional): User on the virtual machine

* `ssh_password` _(string)_ (optional): Password for the virtual machine user

* `orka_vm_builder_name` _(string)_ (optional): Name of the virtual machine that builds the image

* `orka_vm_builder_prefix` _(string)_ (optional): If orka_vm_builder_name is not passed in, you can add prefix to the virtual machine name that the plugin appends a timestamp to. Defaults to packer.

* `orka_enable_net_boost` _(bool)_ (optional): Enable or Disable [Boost IO Performance](https://orkadocs.macstadium.com/docs/cli-reference#options-62), on by default (Intel Only)

* `orka_enable_legacy_io` _(bool)_ (optional): Enable or Disable [Legacy IO](https://orkadocs.macstadium.com/docs/orka-v310#intel-only-support-for-old-os-versions) (Intel Only)

* `orka_vm_cpu_core` _(int)_ (optional):  Number of cpu cores to use with the virtual machine.

* `orka_vm_tag` _(string)_ (optional): Image tag name for the builder VM

* `packer_vm_timeout` _(int)_ (optional): Time packer will wait for a VM to finish launching in minutes. 

* `packer_push_timeout` _(int)_ (optional): Timeout in minutes packer will wait for image to push to an OCI registry. If the timeout is reached, the image will continue to push in the background. Default 60 minutes.

# Development / Internal Variables

If you're NOT a dev working on this software you can ignore the following.

But, if you are building/editing/updating this software, you may want to turn on most or all of the following options.  See the [examples/orka.pkr.hcl](./examples/orka.pkr.hcl) or [examples/macos.json](./examples/macos-catalina.json).

* `do_not_delete` _(bool)_ (optional) _*- for devs*_:  By default this plugin automatically deletes the VM afterwards if all scripts ran successfully. This is useful for debugging builds.

* `do_not_image` _(bool)_ (optional) _*- for devs*_ By default this plugin automatically creates an image of the VM after any provisioning steps.  This is useful for debugging builds.

# Advanced Use Cases

The following use cases do not need to be used in most scenarios.

* `enable_orka_node_ip_mapping` _(bool)_ (optional): The plugin defaults to using the default node ips. If this option is set to true, the builder will use the passed in map under `orka_node_ip_map` to resolve ips.

* `orka_node_ip_map` _(map[string]string)_ (optional): Required if `enable_orka_node_ip_mapping`. Map of Internal Node IPs to External Node Ips.

# Information Notes / Gotchas

[MacStadium Orka] base images have SSH enabled with username:password  `admin:admin` by default.  See the options from the [SSH Communicator] to see how you can customize that.

# Example Orka CLI Commands

These aren't directly related to this plugin, exactly, but they're a bit of a simplified guide to get you started.  For a more full guide see: [Orka Setup Guide].

```bash
# Create a config which is used for source_image above
orka vm create-config -v <vm-name> -c 3 --C 3 --vnc --base-image <base-image> -y

# In essence, this plugin automates running the following 3 commands...
# Start a VM (using the config above)
orka vm deploy -v macos-catalina-10-15-5 --vnc -y

# Save a VM's disk to a disk image
orka image save -v <vmid-here-from-orka-vm-list> -b <destination-image-name> -y

# Stop and remove a VM
orka vm delete --vm <vmid-here-from-orka-vm-list> -y

# Later to launch future images with this image create a new config to launch...
orka vm create-config -v <my-new-packerified-vm> -c 3 --C 3 --vnc --base-image <destination-image-name> -y
# And launch it...
orka vm deploy -v my-new-packerified-vm --vnc -y
# Or, alternatively if you're done working with an image and want to delete it...
orka image delete --image <destination-image-name> -y
```
[//]: <> (Ignore, below here are links for ease-of-use above)
[MacStadium Orka]: https://www.macstadium.com/orka
[MacStadium]: https://www.macstadium.com
[Packer Downloads]: https://www.packer.io/downloads.html
[Orka CLI Downloads]: https://orkadocs.macstadium.com/docs/downloads
[SSH Communicator]: https://www.packer.io/docs/communicators/ssh
[Orka Setup Guide]: https://orkadocs.macstadium.com/docs/quick-start
